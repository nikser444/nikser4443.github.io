<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Современный мессенджер с поддержкой видеозвонков и демонстрации экрана" />
    <meta name="keywords" content="мессенджер, чат, видеозвонки, общение, сообщения" />
    <meta name="author" content="Messenger App" />
    <meta name="theme-color" content="#6366f1" />
    
    <!-- Open Graph метатеги для социальных сетей -->
    <meta property="og:title" content="Messenger - Современный мессенджер" />
    <meta property="og:description" content="Общайтесь с друзьями через текстовые сообщения и видеозвонки" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/icons/og-image.png" />
    
    <!-- Twitter метатеги -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Messenger - Современный мессенджер" />
    <meta name="twitter:description" content="Общайтесь с друзьями через текстовые сообщения и видеозвонки" />
    <meta name="twitter:image" content="/icons/twitter-image.png" />
    
    <!-- Предзагрузка критических ресурсов -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Google Fonts для улучшенной типографики -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Критические CSS стили для предотвращения FOUC -->
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #1f2937;
            background-color: #f9fafb;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Лоадер для начальной загрузки */
        .app-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
        }
        
        .app-loader .loader-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .app-loader .loader-text {
            color: white;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
        }
        
        .app-loader .loader-subtext {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-top: 8px;
            text-align: center;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Скрытие лоадера после загрузки */
        .app-loaded .app-loader {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
        }
        
        /* Отзывчивый дизайн */
        @media (max-width: 768px) {
            body {
                font-size: 16px; /* Предотвращение зума на мобильных */
            }
        }
        
        /* Темная тема по умолчанию для системы */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #111827;
                color: #f9fafb;
            }
            
            .app-loader {
                background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            }
        }
        
        /* Высокий контраст для доступности */
        @media (prefers-contrast: high) {
            body {
                background-color: white;
                color: black;
            }
        }
        
        /* Уменьшенная анимация для пользователей с вестибулярными расстройствами */
        @media (prefers-reduced-motion: reduce) {
            .app-loader .loader-spinner {
                animation: none;
            }
            
            .app-loader {
                transition: none;
            }
        }
    </style>
    
    <title>Messenger - Современный мессенджер</title>
</head>
<body>
    <!-- Основной контейнер React приложения -->
    <div id="root">
        <!-- Лоадер показывается до загрузки React -->
        <div class="app-loader">
            <div class="loader-spinner"></div>
            <div class="loader-text">Загрузка мессенджера</div>
            <div class="loader-subtext">Подготавливаем все для вашего общения...</div>
        </div>
    </div>
    
    <!-- Fallback для пользователей с отключенным JavaScript -->
    <noscript>
        <div style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f9fafb;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-family: 'Inter', sans-serif;
            text-align: center;
            padding: 20px;
        ">
            <h1 style="color: #1f2937; margin-bottom: 16px;">JavaScript отключен</h1>
            <p style="color: #6b7280; font-size: 16px; line-height: 1.6; max-width: 500px;">
                Для работы мессенджера необходимо включить JavaScript в вашем браузере. 
                Пожалуйста, включите JavaScript и перезагрузите страницу.
            </p>
            <div style="margin-top: 20px;">
                <a href="https://enable-javascript.com/" 
                   style="
                       display: inline-block;
                       padding: 12px 24px;
                       background: #6366f1;
                       color: white;
                       text-decoration: none;
                       border-radius: 8px;
                       font-weight: 500;
                   ">
                    Как включить JavaScript
                </a>
            </div>
        </div>
    </noscript>
    
    <!-- Глобальные переменные для конфигурации -->
    <script>
        // Конфигурация для подключения к WebSocket и API
        window.__MESSENGER_CONFIG__ = {
            API_URL: window.location.hostname === 'localhost' 
                ? 'http://localhost:3000/api'
                : '/api',
            SOCKET_URL: window.location.hostname === 'localhost' 
                ? 'http://localhost:3000'
                : window.location.origin,
            WS_RECONNECT_ATTEMPTS: 5,
            WS_RECONNECT_DELAY: 3000,
            MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
            SUPPORTED_FILE_TYPES: [
                'image/jpeg', 'image/png', 'image/gif', 'image/webp',
                'application/pdf', 'text/plain', 
                'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
            ],
            MAX_MESSAGE_LENGTH: 4000,
            TYPING_TIMEOUT: 3000,
            THEME: localStorage.getItem('messenger-theme') || 'system'
        };
        
        // Определение браузера и устройства для аналитики
        window.__MESSENGER_DEVICE__ = {
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
            isAndroid: /Android/.test(navigator.userAgent),
            isSafari: /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
            supportsWebRTC: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
            supportsNotifications: 'Notification' in window,
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
        };
        
        // Функция для скрытия лоадера после загрузки React
        window.__hideAppLoader__ = function() {
            document.body.classList.add('app-loaded');
            setTimeout(() => {
                const loader = document.querySelector('.app-loader');
                if (loader) {
                    loader.remove();
                }
            }, 300);
        };
        
        // Обработка ошибок JavaScript
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            // Здесь можно добавить отправку ошибок на сервер аналитики
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            // Здесь можно добавить отправку ошибок на сервер аналитики
        });
        
        // Предотвращение контекстного меню в продакшене (опционально)
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            document.addEventListener('contextmenu', function(e) {
                // Разрешаем контекстное меню для полей ввода
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
                    return;
                }
                e.preventDefault();
            });
        }
        
        // Автоматическое определение темы
        if (window.__MESSENGER_CONFIG__.THEME === 'system') {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.classList.toggle('dark', prefersDark);
        }
    </script>
    
    <!-- Подключение основного JavaScript файла React приложения -->
    <script type="module" src="/src/main.tsx"></script>
</body>
</html>